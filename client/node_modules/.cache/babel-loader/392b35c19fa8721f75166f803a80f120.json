{"ast":null,"code":"\"use strict\";\n\nfunction _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nrequire(\"core-js/modules/web.url\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = createChannel;\nexports.PostmsgTransport = exports.KEY = void 0;\n\nvar _global = require(\"global\");\n\nvar EVENTS = _interopRequireWildcard(require(\"@storybook/core-events\"));\n\nvar _channels = _interopRequireDefault(require(\"@storybook/channels\"));\n\nvar _clientLogger = require(\"@storybook/client-logger\");\n\nvar _telejson = require(\"telejson\");\n\nvar _qs = _interopRequireDefault(require(\"qs\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    \"default\": obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") {\n    return {\n      \"default\": obj\n    };\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n  var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) {\n      var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n      if (desc && (desc.get || desc.set)) {\n        Object.defineProperty(newObj, key, desc);\n      } else {\n        newObj[key] = obj[key];\n      }\n    }\n  }\n\n  newObj[\"default\"] = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _toArray(arr) {\n  return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\n\nfunction _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return _arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(o);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);\n}\n\nfunction _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return _arrayLikeToArray(arr);\n}\n\nfunction _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nvar KEY = 'storybook-channel'; // TODO: we should export a method for opening child windows here and keep track of em.\n// that way we can send postMessage to child windows as well, not just iframe\n// https://stackoverflow.com/questions/6340160/how-to-get-the-references-of-all-already-opened-child-windows\n\nexports.KEY = KEY;\n\nvar PostmsgTransport = /*#__PURE__*/function () {\n  function PostmsgTransport(config) {\n    _classCallCheck(this, PostmsgTransport);\n\n    this.config = config;\n    this.buffer = void 0;\n    this.handler = void 0;\n    this.connected = void 0;\n    this.buffer = [];\n    this.handler = null;\n\n    _global.window.addEventListener('message', this.handleEvent.bind(this), false); // Check whether the config.page parameter has a valid value\n\n\n    if (config.page !== 'manager' && config.page !== 'preview') {\n      throw new Error(\"postmsg-channel: \\\"config.page\\\" cannot be \\\"\".concat(config.page, \"\\\"\"));\n    }\n  }\n\n  _createClass(PostmsgTransport, [{\n    key: \"setHandler\",\n    value: function setHandler(handler) {\n      var _this = this;\n\n      this.handler = function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        handler.apply(_this, args);\n\n        if (!_this.connected && _this.getLocalFrame().length) {\n          _this.flush();\n\n          _this.connected = true;\n        }\n      };\n    }\n    /**\n     * Sends `event` to the associated window. If the window does not yet exist\n     * the event will be stored in a buffer and sent when the window exists.\n     * @param event\n     */\n\n  }, {\n    key: \"send\",\n    value: function send(event, options) {\n      var _this2 = this;\n\n      var depth = 25;\n      var allowFunction = true;\n      var target;\n\n      if (options && typeof options.allowFunction === 'boolean') {\n        allowFunction = options.allowFunction;\n      }\n\n      if (options && Number.isInteger(options.depth)) {\n        depth = options.depth;\n      }\n\n      if (options && typeof options.target === 'string') {\n        target = options.target;\n      }\n\n      var frames = this.getFrames(target);\n\n      var query = _qs[\"default\"].parse(_global.location.search, {\n        ignoreQueryPrefix: true\n      });\n\n      var data = (0, _telejson.stringify)({\n        key: KEY,\n        event: event,\n        refId: query.refId\n      }, {\n        maxDepth: depth,\n        allowFunction: allowFunction\n      });\n\n      if (!frames.length) {\n        return new Promise(function (resolve, reject) {\n          _this2.buffer.push({\n            event: event,\n            resolve: resolve,\n            reject: reject\n          });\n        });\n      }\n\n      if (this.buffer.length) {\n        this.flush();\n      }\n\n      frames.forEach(function (f) {\n        try {\n          f.postMessage(data, '*');\n        } catch (e) {\n          console.error('sending over postmessage fail');\n        }\n      });\n      return Promise.resolve(null);\n    }\n  }, {\n    key: \"flush\",\n    value: function flush() {\n      var _this3 = this;\n\n      var buffer = this.buffer;\n      this.buffer = [];\n      buffer.forEach(function (item) {\n        _this3.send(item.event).then(item.resolve)[\"catch\"](item.reject);\n      });\n    }\n  }, {\n    key: \"getFrames\",\n    value: function getFrames(target) {\n      if (this.config.page === 'manager') {\n        var nodes = _toConsumableArray(_global.document.querySelectorAll('iframe[data-is-storybook][data-is-loaded]'));\n\n        var list = nodes.filter(function (e) {\n          try {\n            return !!e.contentWindow && e.dataset.isStorybook !== undefined && e.id === target;\n          } catch (er) {\n            return false;\n          }\n        }).map(function (e) {\n          return e.contentWindow;\n        });\n        return list.length ? list : this.getCurrentFrames();\n      }\n\n      if (_global.window && _global.window.parent && _global.window.parent !== _global.window) {\n        return [_global.window.parent];\n      }\n\n      return [];\n    }\n  }, {\n    key: \"getCurrentFrames\",\n    value: function getCurrentFrames() {\n      if (this.config.page === 'manager') {\n        var list = _toConsumableArray(_global.document.querySelectorAll('[data-is-storybook=\"true\"]'));\n\n        return list.map(function (e) {\n          return e.contentWindow;\n        });\n      }\n\n      if (_global.window && _global.window.parent) {\n        return [_global.window.parent];\n      }\n\n      return [];\n    }\n  }, {\n    key: \"getLocalFrame\",\n    value: function getLocalFrame() {\n      if (this.config.page === 'manager') {\n        var list = _toConsumableArray(_global.document.querySelectorAll('#storybook-preview-iframe'));\n\n        return list.map(function (e) {\n          return e.contentWindow;\n        });\n      }\n\n      if (_global.window && _global.window.parent) {\n        return [_global.window.parent];\n      }\n\n      return [];\n    }\n  }, {\n    key: \"handleEvent\",\n    value: function handleEvent(rawEvent) {\n      try {\n        var data = rawEvent.data;\n\n        var _ref = typeof data === 'string' && (0, _telejson.isJSON)(data) ? (0, _telejson.parse)(data) : data,\n            key = _ref.key,\n            event = _ref.event,\n            refId = _ref.refId;\n\n        if (key === KEY) {\n          var pageString = this.config.page === 'manager' ? \"<span style=\\\"color: #37D5D3; background: black\\\"> manager </span>\" : \"<span style=\\\"color: #1EA7FD; background: black\\\"> preview </span>\";\n          var eventString = Object.values(EVENTS).includes(event.type) ? \"<span style=\\\"color: #FF4785\\\">\".concat(event.type, \"</span>\") : \"<span style=\\\"color: #FFAE00\\\">\".concat(event.type, \"</span>\");\n\n          if (refId) {\n            event.refId = refId;\n          }\n\n          event.source = this.config.page === 'preview' ? rawEvent.origin : getEventSourceUrl(rawEvent);\n\n          if (!event.source) {\n            _clientLogger.pretty.error(\"\".concat(pageString, \" received \").concat(eventString, \" but was unable to determine the source of the event\"));\n\n            return;\n          }\n\n          var message = \"\".concat(pageString, \" received \").concat(eventString, \" (\").concat(data.length, \")\");\n\n          _clientLogger.pretty.debug.apply(_clientLogger.pretty, [_global.location.origin !== event.source ? message : \"\".concat(message, \" <span style=\\\"color: gray\\\">(on \").concat(_global.location.origin, \" from \").concat(event.source, \")</span>\")].concat(_toConsumableArray(event.args)));\n\n          this.handler(event);\n        }\n      } catch (error) {\n        _clientLogger.logger.error(error);\n      }\n    }\n  }]);\n\n  return PostmsgTransport;\n}();\n\nexports.PostmsgTransport = PostmsgTransport;\n\nvar getEventSourceUrl = function getEventSourceUrl(event) {\n  var frames = _toConsumableArray(_global.document.querySelectorAll('iframe[data-is-storybook]')); // try to find the originating iframe by matching it's contentWindow\n  // This might not be cross-origin safe\n\n\n  var _frames$filter = frames.filter(function (element) {\n    try {\n      return element.contentWindow === event.source;\n    } catch (err) {// continue\n    }\n\n    var src = element.getAttribute('src');\n    var origin;\n\n    try {\n      var _URL = new URL(src, _global.document.location);\n\n      origin = _URL.origin;\n    } catch (err) {\n      return false;\n    }\n\n    return origin === event.origin;\n  }),\n      _frames$filter2 = _toArray(_frames$filter),\n      frame = _frames$filter2[0],\n      remainder = _frames$filter2.slice(1);\n\n  if (frame && remainder.length === 0) {\n    var src = frame.getAttribute('src');\n\n    var _URL2 = new URL(src, _global.document.location),\n        origin = _URL2.origin,\n        pathname = _URL2.pathname;\n\n    return origin + pathname;\n  }\n\n  if (remainder.length > 0) {\n    // If we found multiple matches, there's going to be trouble\n    _clientLogger.logger.error('found multiple candidates for event source');\n  } // If we found no frames of matches\n\n\n  return null;\n};\n/**\n * Creates a channel which communicates with an iframe or child window.\n */\n\n\nfunction createChannel(_ref2) {\n  var page = _ref2.page;\n  var transport = new PostmsgTransport({\n    page: page\n  });\n  return new _channels[\"default\"]({\n    transport: transport\n  });\n}","map":{"version":3,"sources":["/home/leon/Documentos/proyectos/react/mascaras/client/node_modules/@storybook/channel-postmessage/dist/index.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","require","Object","defineProperty","exports","value","createChannel","PostmsgTransport","KEY","_global","EVENTS","_interopRequireWildcard","_channels","_interopRequireDefault","_clientLogger","_telejson","_qs","__esModule","_getRequireWildcardCache","WeakMap","cache","has","get","newObj","hasPropertyDescriptor","getOwnPropertyDescriptor","key","hasOwnProperty","call","desc","set","_toArray","arr","_arrayWithHoles","_iterableToArray","_unsupportedIterableToArray","_nonIterableRest","TypeError","Array","isArray","_toConsumableArray","_arrayWithoutHoles","_nonIterableSpread","o","minLen","_arrayLikeToArray","n","toString","slice","name","from","test","iter","len","length","i","arr2","_classCallCheck","instance","Constructor","_defineProperties","target","props","descriptor","enumerable","configurable","writable","_createClass","protoProps","staticProps","config","buffer","handler","connected","window","addEventListener","handleEvent","bind","page","Error","concat","setHandler","_this","_len","arguments","args","_key","apply","getLocalFrame","flush","send","event","options","_this2","depth","allowFunction","Number","isInteger","frames","getFrames","query","parse","location","search","ignoreQueryPrefix","data","stringify","refId","maxDepth","Promise","resolve","reject","push","forEach","f","postMessage","e","console","error","_this3","item","then","nodes","document","querySelectorAll","list","filter","contentWindow","dataset","isStorybook","undefined","id","er","map","getCurrentFrames","parent","rawEvent","_ref","isJSON","pageString","eventString","values","includes","type","source","origin","getEventSourceUrl","pretty","message","debug","logger","_frames$filter","element","err","src","getAttribute","_URL","URL","_frames$filter2","frame","remainder","_URL2","pathname","_ref2","transport"],"mappings":"AAAA;;AAEA,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE;;AAA2B,MAAI,OAAOC,MAAP,KAAkB,UAAlB,IAAgC,OAAOA,MAAM,CAACC,QAAd,KAA2B,QAA/D,EAAyE;AAAEH,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE,aAAO,OAAOA,GAAd;AAAoB,KAAtD;AAAyD,GAApI,MAA0I;AAAED,IAAAA,OAAO,GAAG,SAASA,OAAT,CAAiBC,GAAjB,EAAsB;AAAE,aAAOA,GAAG,IAAI,OAAOC,MAAP,KAAkB,UAAzB,IAAuCD,GAAG,CAACG,WAAJ,KAAoBF,MAA3D,IAAqED,GAAG,KAAKC,MAAM,CAACG,SAApF,GAAgG,QAAhG,GAA2G,OAAOJ,GAAzH;AAA+H,KAAjK;AAAoK;;AAAC,SAAOD,OAAO,CAACC,GAAD,CAAd;AAAsB;;AA0D1XK,OAAO,CAAC,yBAAD,CAAP;;AAEAC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAC3CC,EAAAA,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAAC,SAAD,CAAP,GAAqBE,aAArB;AACAF,OAAO,CAACG,gBAAR,GAA2BH,OAAO,CAACI,GAAR,GAAc,KAAK,CAA9C;;AAEA,IAAIC,OAAO,GAAGR,OAAO,CAAC,QAAD,CAArB;;AAEA,IAAIS,MAAM,GAAGC,uBAAuB,CAACV,OAAO,CAAC,wBAAD,CAAR,CAApC;;AAEA,IAAIW,SAAS,GAAGC,sBAAsB,CAACZ,OAAO,CAAC,qBAAD,CAAR,CAAtC;;AAEA,IAAIa,aAAa,GAAGb,OAAO,CAAC,0BAAD,CAA3B;;AAEA,IAAIc,SAAS,GAAGd,OAAO,CAAC,UAAD,CAAvB;;AAEA,IAAIe,GAAG,GAAGH,sBAAsB,CAACZ,OAAO,CAAC,IAAD,CAAR,CAAhC;;AAEA,SAASY,sBAAT,CAAgCjB,GAAhC,EAAqC;AAAE,SAAOA,GAAG,IAAIA,GAAG,CAACqB,UAAX,GAAwBrB,GAAxB,GAA8B;AAAE,eAAWA;AAAb,GAArC;AAA0D;;AAEjG,SAASsB,wBAAT,GAAoC;AAAE,MAAI,OAAOC,OAAP,KAAmB,UAAvB,EAAmC,OAAO,IAAP;AAAa,MAAIC,KAAK,GAAG,IAAID,OAAJ,EAAZ;;AAA2BD,EAAAA,wBAAwB,GAAG,SAASA,wBAAT,GAAoC;AAAE,WAAOE,KAAP;AAAe,GAAhF;;AAAkF,SAAOA,KAAP;AAAe;;AAElN,SAAST,uBAAT,CAAiCf,GAAjC,EAAsC;AAAE,MAAIA,GAAG,IAAIA,GAAG,CAACqB,UAAf,EAA2B;AAAE,WAAOrB,GAAP;AAAa;;AAAC,MAAIA,GAAG,KAAK,IAAR,IAAgBD,OAAO,CAACC,GAAD,CAAP,KAAiB,QAAjB,IAA6B,OAAOA,GAAP,KAAe,UAAhE,EAA4E;AAAE,WAAO;AAAE,iBAAWA;AAAb,KAAP;AAA4B;;AAAC,MAAIwB,KAAK,GAAGF,wBAAwB,EAApC;;AAAwC,MAAIE,KAAK,IAAIA,KAAK,CAACC,GAAN,CAAUzB,GAAV,CAAb,EAA6B;AAAE,WAAOwB,KAAK,CAACE,GAAN,CAAU1B,GAAV,CAAP;AAAwB;;AAAC,MAAI2B,MAAM,GAAG,EAAb;AAAiB,MAAIC,qBAAqB,GAAGtB,MAAM,CAACC,cAAP,IAAyBD,MAAM,CAACuB,wBAA5D;;AAAsF,OAAK,IAAIC,GAAT,IAAgB9B,GAAhB,EAAqB;AAAE,QAAIM,MAAM,CAACF,SAAP,CAAiB2B,cAAjB,CAAgCC,IAAhC,CAAqChC,GAArC,EAA0C8B,GAA1C,CAAJ,EAAoD;AAAE,UAAIG,IAAI,GAAGL,qBAAqB,GAAGtB,MAAM,CAACuB,wBAAP,CAAgC7B,GAAhC,EAAqC8B,GAArC,CAAH,GAA+C,IAA/E;;AAAqF,UAAIG,IAAI,KAAKA,IAAI,CAACP,GAAL,IAAYO,IAAI,CAACC,GAAtB,CAAR,EAAoC;AAAE5B,QAAAA,MAAM,CAACC,cAAP,CAAsBoB,MAAtB,EAA8BG,GAA9B,EAAmCG,IAAnC;AAA2C,OAAjF,MAAuF;AAAEN,QAAAA,MAAM,CAACG,GAAD,CAAN,GAAc9B,GAAG,CAAC8B,GAAD,CAAjB;AAAyB;AAAE;AAAE;;AAACH,EAAAA,MAAM,CAAC,SAAD,CAAN,GAAoB3B,GAApB;;AAAyB,MAAIwB,KAAJ,EAAW;AAAEA,IAAAA,KAAK,CAACU,GAAN,CAAUlC,GAAV,EAAe2B,MAAf;AAAyB;;AAAC,SAAOA,MAAP;AAAgB;;AAE9uB,SAASQ,QAAT,CAAkBC,GAAlB,EAAuB;AAAE,SAAOC,eAAe,CAACD,GAAD,CAAf,IAAwBE,gBAAgB,CAACF,GAAD,CAAxC,IAAiDG,2BAA2B,CAACH,GAAD,CAA5E,IAAqFI,gBAAgB,EAA5G;AAAiH;;AAE1I,SAASA,gBAAT,GAA4B;AAAE,QAAM,IAAIC,SAAJ,CAAc,2IAAd,CAAN;AAAmK;;AAEjM,SAASJ,eAAT,CAAyBD,GAAzB,EAA8B;AAAE,MAAIM,KAAK,CAACC,OAAN,CAAcP,GAAd,CAAJ,EAAwB,OAAOA,GAAP;AAAa;;AAErE,SAASQ,kBAAT,CAA4BR,GAA5B,EAAiC;AAAE,SAAOS,kBAAkB,CAACT,GAAD,CAAlB,IAA2BE,gBAAgB,CAACF,GAAD,CAA3C,IAAoDG,2BAA2B,CAACH,GAAD,CAA/E,IAAwFU,kBAAkB,EAAjH;AAAsH;;AAEzJ,SAASA,kBAAT,GAA8B;AAAE,QAAM,IAAIL,SAAJ,CAAc,sIAAd,CAAN;AAA8J;;AAE9L,SAASF,2BAAT,CAAqCQ,CAArC,EAAwCC,MAAxC,EAAgD;AAAE,MAAI,CAACD,CAAL,EAAQ;AAAQ,MAAI,OAAOA,CAAP,KAAa,QAAjB,EAA2B,OAAOE,iBAAiB,CAACF,CAAD,EAAIC,MAAJ,CAAxB;AAAqC,MAAIE,CAAC,GAAG5C,MAAM,CAACF,SAAP,CAAiB+C,QAAjB,CAA0BnB,IAA1B,CAA+Be,CAA/B,EAAkCK,KAAlC,CAAwC,CAAxC,EAA2C,CAAC,CAA5C,CAAR;AAAwD,MAAIF,CAAC,KAAK,QAAN,IAAkBH,CAAC,CAAC5C,WAAxB,EAAqC+C,CAAC,GAAGH,CAAC,CAAC5C,WAAF,CAAckD,IAAlB;AAAwB,MAAIH,CAAC,KAAK,KAAN,IAAeA,CAAC,KAAK,KAAzB,EAAgC,OAAOR,KAAK,CAACY,IAAN,CAAWP,CAAX,CAAP;AAAsB,MAAIG,CAAC,KAAK,WAAN,IAAqB,2CAA2CK,IAA3C,CAAgDL,CAAhD,CAAzB,EAA6E,OAAOD,iBAAiB,CAACF,CAAD,EAAIC,MAAJ,CAAxB;AAAsC;;AAEha,SAASV,gBAAT,CAA0BkB,IAA1B,EAAgC;AAAE,MAAI,OAAOvD,MAAP,KAAkB,WAAlB,IAAiCA,MAAM,CAACC,QAAP,IAAmBI,MAAM,CAACkD,IAAD,CAA9D,EAAsE,OAAOd,KAAK,CAACY,IAAN,CAAWE,IAAX,CAAP;AAA0B;;AAElI,SAASX,kBAAT,CAA4BT,GAA5B,EAAiC;AAAE,MAAIM,KAAK,CAACC,OAAN,CAAcP,GAAd,CAAJ,EAAwB,OAAOa,iBAAiB,CAACb,GAAD,CAAxB;AAAgC;;AAE3F,SAASa,iBAAT,CAA2Bb,GAA3B,EAAgCqB,GAAhC,EAAqC;AAAE,MAAIA,GAAG,IAAI,IAAP,IAAeA,GAAG,GAAGrB,GAAG,CAACsB,MAA7B,EAAqCD,GAAG,GAAGrB,GAAG,CAACsB,MAAV;;AAAkB,OAAK,IAAIC,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG,IAAIlB,KAAJ,CAAUe,GAAV,CAAvB,EAAuCE,CAAC,GAAGF,GAA3C,EAAgDE,CAAC,EAAjD,EAAqD;AAAEC,IAAAA,IAAI,CAACD,CAAD,CAAJ,GAAUvB,GAAG,CAACuB,CAAD,CAAb;AAAmB;;AAAC,SAAOC,IAAP;AAAc;;AAEvL,SAASC,eAAT,CAAyBC,QAAzB,EAAmCC,WAAnC,EAAgD;AAAE,MAAI,EAAED,QAAQ,YAAYC,WAAtB,CAAJ,EAAwC;AAAE,UAAM,IAAItB,SAAJ,CAAc,mCAAd,CAAN;AAA2D;AAAE;;AAEzJ,SAASuB,iBAAT,CAA2BC,MAA3B,EAAmCC,KAAnC,EAA0C;AAAE,OAAK,IAAIP,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGO,KAAK,CAACR,MAA1B,EAAkCC,CAAC,EAAnC,EAAuC;AAAE,QAAIQ,UAAU,GAAGD,KAAK,CAACP,CAAD,CAAtB;AAA2BQ,IAAAA,UAAU,CAACC,UAAX,GAAwBD,UAAU,CAACC,UAAX,IAAyB,KAAjD;AAAwDD,IAAAA,UAAU,CAACE,YAAX,GAA0B,IAA1B;AAAgC,QAAI,WAAWF,UAAf,EAA2BA,UAAU,CAACG,QAAX,GAAsB,IAAtB;AAA4BhE,IAAAA,MAAM,CAACC,cAAP,CAAsB0D,MAAtB,EAA8BE,UAAU,CAACrC,GAAzC,EAA8CqC,UAA9C;AAA4D;AAAE;;AAE7T,SAASI,YAAT,CAAsBR,WAAtB,EAAmCS,UAAnC,EAA+CC,WAA/C,EAA4D;AAAE,MAAID,UAAJ,EAAgBR,iBAAiB,CAACD,WAAW,CAAC3D,SAAb,EAAwBoE,UAAxB,CAAjB;AAAsD,MAAIC,WAAJ,EAAiBT,iBAAiB,CAACD,WAAD,EAAcU,WAAd,CAAjB;AAA6C,SAAOV,WAAP;AAAqB;;AAEvN,IAAInD,GAAG,GAAG,mBAAV,C,CAA+B;AAC/B;AACA;;AAEAJ,OAAO,CAACI,GAAR,GAAcA,GAAd;;AAEA,IAAID,gBAAgB,GAAG,aAAa,YAAY;AAC9C,WAASA,gBAAT,CAA0B+D,MAA1B,EAAkC;AAChCb,IAAAA,eAAe,CAAC,IAAD,EAAOlD,gBAAP,CAAf;;AAEA,SAAK+D,MAAL,GAAcA,MAAd;AACA,SAAKC,MAAL,GAAc,KAAK,CAAnB;AACA,SAAKC,OAAL,GAAe,KAAK,CAApB;AACA,SAAKC,SAAL,GAAiB,KAAK,CAAtB;AACA,SAAKF,MAAL,GAAc,EAAd;AACA,SAAKC,OAAL,GAAe,IAAf;;AAEA/D,IAAAA,OAAO,CAACiE,MAAR,CAAeC,gBAAf,CAAgC,SAAhC,EAA2C,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAA3C,EAAwE,KAAxE,EAVgC,CAUgD;;;AAGhF,QAAIP,MAAM,CAACQ,IAAP,KAAgB,SAAhB,IAA6BR,MAAM,CAACQ,IAAP,KAAgB,SAAjD,EAA4D;AAC1D,YAAM,IAAIC,KAAJ,CAAU,gDAAgDC,MAAhD,CAAuDV,MAAM,CAACQ,IAA9D,EAAoE,IAApE,CAAV,CAAN;AACD;AACF;;AAEDX,EAAAA,YAAY,CAAC5D,gBAAD,EAAmB,CAAC;AAC9BmB,IAAAA,GAAG,EAAE,YADyB;AAE9BrB,IAAAA,KAAK,EAAE,SAAS4E,UAAT,CAAoBT,OAApB,EAA6B;AAClC,UAAIU,KAAK,GAAG,IAAZ;;AAEA,WAAKV,OAAL,GAAe,YAAY;AACzB,aAAK,IAAIW,IAAI,GAAGC,SAAS,CAAC9B,MAArB,EAA6B+B,IAAI,GAAG,IAAI/C,KAAJ,CAAU6C,IAAV,CAApC,EAAqDG,IAAI,GAAG,CAAjE,EAAoEA,IAAI,GAAGH,IAA3E,EAAiFG,IAAI,EAArF,EAAyF;AACvFD,UAAAA,IAAI,CAACC,IAAD,CAAJ,GAAaF,SAAS,CAACE,IAAD,CAAtB;AACD;;AAEDd,QAAAA,OAAO,CAACe,KAAR,CAAcL,KAAd,EAAqBG,IAArB;;AAEA,YAAI,CAACH,KAAK,CAACT,SAAP,IAAoBS,KAAK,CAACM,aAAN,GAAsBlC,MAA9C,EAAsD;AACpD4B,UAAAA,KAAK,CAACO,KAAN;;AAEAP,UAAAA,KAAK,CAACT,SAAN,GAAkB,IAAlB;AACD;AACF,OAZD;AAaD;AACD;AACJ;AACA;AACA;AACA;;AAvBkC,GAAD,EAyB5B;AACD/C,IAAAA,GAAG,EAAE,MADJ;AAEDrB,IAAAA,KAAK,EAAE,SAASqF,IAAT,CAAcC,KAAd,EAAqBC,OAArB,EAA8B;AACnC,UAAIC,MAAM,GAAG,IAAb;;AAEA,UAAIC,KAAK,GAAG,EAAZ;AACA,UAAIC,aAAa,GAAG,IAApB;AACA,UAAIlC,MAAJ;;AAEA,UAAI+B,OAAO,IAAI,OAAOA,OAAO,CAACG,aAAf,KAAiC,SAAhD,EAA2D;AACzDA,QAAAA,aAAa,GAAGH,OAAO,CAACG,aAAxB;AACD;;AAED,UAAIH,OAAO,IAAII,MAAM,CAACC,SAAP,CAAiBL,OAAO,CAACE,KAAzB,CAAf,EAAgD;AAC9CA,QAAAA,KAAK,GAAGF,OAAO,CAACE,KAAhB;AACD;;AAED,UAAIF,OAAO,IAAI,OAAOA,OAAO,CAAC/B,MAAf,KAA0B,QAAzC,EAAmD;AACjDA,QAAAA,MAAM,GAAG+B,OAAO,CAAC/B,MAAjB;AACD;;AAED,UAAIqC,MAAM,GAAG,KAAKC,SAAL,CAAetC,MAAf,CAAb;;AAEA,UAAIuC,KAAK,GAAGpF,GAAG,CAAC,SAAD,CAAH,CAAeqF,KAAf,CAAqB5F,OAAO,CAAC6F,QAAR,CAAiBC,MAAtC,EAA8C;AACxDC,QAAAA,iBAAiB,EAAE;AADqC,OAA9C,CAAZ;;AAIA,UAAIC,IAAI,GAAG,CAAC,GAAG1F,SAAS,CAAC2F,SAAd,EAAyB;AAClChF,QAAAA,GAAG,EAAElB,GAD6B;AAElCmF,QAAAA,KAAK,EAAEA,KAF2B;AAGlCgB,QAAAA,KAAK,EAAEP,KAAK,CAACO;AAHqB,OAAzB,EAIR;AACDC,QAAAA,QAAQ,EAAEd,KADT;AAEDC,QAAAA,aAAa,EAAEA;AAFd,OAJQ,CAAX;;AASA,UAAI,CAACG,MAAM,CAAC5C,MAAZ,EAAoB;AAClB,eAAO,IAAIuD,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5ClB,UAAAA,MAAM,CAACtB,MAAP,CAAcyC,IAAd,CAAmB;AACjBrB,YAAAA,KAAK,EAAEA,KADU;AAEjBmB,YAAAA,OAAO,EAAEA,OAFQ;AAGjBC,YAAAA,MAAM,EAAEA;AAHS,WAAnB;AAKD,SANM,CAAP;AAOD;;AAED,UAAI,KAAKxC,MAAL,CAAYjB,MAAhB,EAAwB;AACtB,aAAKmC,KAAL;AACD;;AAEDS,MAAAA,MAAM,CAACe,OAAP,CAAe,UAAUC,CAAV,EAAa;AAC1B,YAAI;AACFA,UAAAA,CAAC,CAACC,WAAF,CAAcV,IAAd,EAAoB,GAApB;AACD,SAFD,CAEE,OAAOW,CAAP,EAAU;AACVC,UAAAA,OAAO,CAACC,KAAR,CAAc,+BAAd;AACD;AACF,OAND;AAOA,aAAOT,OAAO,CAACC,OAAR,CAAgB,IAAhB,CAAP;AACD;AA1DA,GAzB4B,EAoF5B;AACDpF,IAAAA,GAAG,EAAE,OADJ;AAEDrB,IAAAA,KAAK,EAAE,SAASoF,KAAT,GAAiB;AACtB,UAAI8B,MAAM,GAAG,IAAb;;AAEA,UAAIhD,MAAM,GAAG,KAAKA,MAAlB;AACA,WAAKA,MAAL,GAAc,EAAd;AACAA,MAAAA,MAAM,CAAC0C,OAAP,CAAe,UAAUO,IAAV,EAAgB;AAC7BD,QAAAA,MAAM,CAAC7B,IAAP,CAAY8B,IAAI,CAAC7B,KAAjB,EAAwB8B,IAAxB,CAA6BD,IAAI,CAACV,OAAlC,EAA2C,OAA3C,EAAoDU,IAAI,CAACT,MAAzD;AACD,OAFD;AAGD;AAVA,GApF4B,EA+F5B;AACDrF,IAAAA,GAAG,EAAE,WADJ;AAEDrB,IAAAA,KAAK,EAAE,SAAS8F,SAAT,CAAmBtC,MAAnB,EAA2B;AAChC,UAAI,KAAKS,MAAL,CAAYQ,IAAZ,KAAqB,SAAzB,EAAoC;AAClC,YAAI4C,KAAK,GAAGlF,kBAAkB,CAAC/B,OAAO,CAACkH,QAAR,CAAiBC,gBAAjB,CAAkC,2CAAlC,CAAD,CAA9B;;AAEA,YAAIC,IAAI,GAAGH,KAAK,CAACI,MAAN,CAAa,UAAUV,CAAV,EAAa;AACnC,cAAI;AACF,mBAAO,CAAC,CAACA,CAAC,CAACW,aAAJ,IAAqBX,CAAC,CAACY,OAAF,CAAUC,WAAV,KAA0BC,SAA/C,IAA4Dd,CAAC,CAACe,EAAF,KAAStE,MAA5E;AACD,WAFD,CAEE,OAAOuE,EAAP,EAAW;AACX,mBAAO,KAAP;AACD;AACF,SANU,EAMRC,GANQ,CAMJ,UAAUjB,CAAV,EAAa;AAClB,iBAAOA,CAAC,CAACW,aAAT;AACD,SARU,CAAX;AASA,eAAOF,IAAI,CAACvE,MAAL,GAAcuE,IAAd,GAAqB,KAAKS,gBAAL,EAA5B;AACD;;AAED,UAAI7H,OAAO,CAACiE,MAAR,IAAkBjE,OAAO,CAACiE,MAAR,CAAe6D,MAAjC,IAA2C9H,OAAO,CAACiE,MAAR,CAAe6D,MAAf,KAA0B9H,OAAO,CAACiE,MAAjF,EAAyF;AACvF,eAAO,CAACjE,OAAO,CAACiE,MAAR,CAAe6D,MAAhB,CAAP;AACD;;AAED,aAAO,EAAP;AACD;AAvBA,GA/F4B,EAuH5B;AACD7G,IAAAA,GAAG,EAAE,kBADJ;AAEDrB,IAAAA,KAAK,EAAE,SAASiI,gBAAT,GAA4B;AACjC,UAAI,KAAKhE,MAAL,CAAYQ,IAAZ,KAAqB,SAAzB,EAAoC;AAClC,YAAI+C,IAAI,GAAGrF,kBAAkB,CAAC/B,OAAO,CAACkH,QAAR,CAAiBC,gBAAjB,CAAkC,4BAAlC,CAAD,CAA7B;;AAEA,eAAOC,IAAI,CAACQ,GAAL,CAAS,UAAUjB,CAAV,EAAa;AAC3B,iBAAOA,CAAC,CAACW,aAAT;AACD,SAFM,CAAP;AAGD;;AAED,UAAItH,OAAO,CAACiE,MAAR,IAAkBjE,OAAO,CAACiE,MAAR,CAAe6D,MAArC,EAA6C;AAC3C,eAAO,CAAC9H,OAAO,CAACiE,MAAR,CAAe6D,MAAhB,CAAP;AACD;;AAED,aAAO,EAAP;AACD;AAhBA,GAvH4B,EAwI5B;AACD7G,IAAAA,GAAG,EAAE,eADJ;AAEDrB,IAAAA,KAAK,EAAE,SAASmF,aAAT,GAAyB;AAC9B,UAAI,KAAKlB,MAAL,CAAYQ,IAAZ,KAAqB,SAAzB,EAAoC;AAClC,YAAI+C,IAAI,GAAGrF,kBAAkB,CAAC/B,OAAO,CAACkH,QAAR,CAAiBC,gBAAjB,CAAkC,2BAAlC,CAAD,CAA7B;;AAEA,eAAOC,IAAI,CAACQ,GAAL,CAAS,UAAUjB,CAAV,EAAa;AAC3B,iBAAOA,CAAC,CAACW,aAAT;AACD,SAFM,CAAP;AAGD;;AAED,UAAItH,OAAO,CAACiE,MAAR,IAAkBjE,OAAO,CAACiE,MAAR,CAAe6D,MAArC,EAA6C;AAC3C,eAAO,CAAC9H,OAAO,CAACiE,MAAR,CAAe6D,MAAhB,CAAP;AACD;;AAED,aAAO,EAAP;AACD;AAhBA,GAxI4B,EAyJ5B;AACD7G,IAAAA,GAAG,EAAE,aADJ;AAEDrB,IAAAA,KAAK,EAAE,SAASuE,WAAT,CAAqB4D,QAArB,EAA+B;AACpC,UAAI;AACF,YAAI/B,IAAI,GAAG+B,QAAQ,CAAC/B,IAApB;;AAEA,YAAIgC,IAAI,GAAG,OAAOhC,IAAP,KAAgB,QAAhB,IAA4B,CAAC,GAAG1F,SAAS,CAAC2H,MAAd,EAAsBjC,IAAtB,CAA5B,GAA0D,CAAC,GAAG1F,SAAS,CAACsF,KAAd,EAAqBI,IAArB,CAA1D,GAAuFA,IAAlG;AAAA,YACI/E,GAAG,GAAG+G,IAAI,CAAC/G,GADf;AAAA,YAEIiE,KAAK,GAAG8C,IAAI,CAAC9C,KAFjB;AAAA,YAGIgB,KAAK,GAAG8B,IAAI,CAAC9B,KAHjB;;AAKA,YAAIjF,GAAG,KAAKlB,GAAZ,EAAiB;AACf,cAAImI,UAAU,GAAG,KAAKrE,MAAL,CAAYQ,IAAZ,KAAqB,SAArB,GAAiC,oEAAjC,GAAwG,oEAAzH;AACA,cAAI8D,WAAW,GAAG1I,MAAM,CAAC2I,MAAP,CAAcnI,MAAd,EAAsBoI,QAAtB,CAA+BnD,KAAK,CAACoD,IAArC,IAA6C,kCAAkC/D,MAAlC,CAAyCW,KAAK,CAACoD,IAA/C,EAAqD,SAArD,CAA7C,GAA+G,kCAAkC/D,MAAlC,CAAyCW,KAAK,CAACoD,IAA/C,EAAqD,SAArD,CAAjI;;AAEA,cAAIpC,KAAJ,EAAW;AACThB,YAAAA,KAAK,CAACgB,KAAN,GAAcA,KAAd;AACD;;AAEDhB,UAAAA,KAAK,CAACqD,MAAN,GAAe,KAAK1E,MAAL,CAAYQ,IAAZ,KAAqB,SAArB,GAAiC0D,QAAQ,CAACS,MAA1C,GAAmDC,iBAAiB,CAACV,QAAD,CAAnF;;AAEA,cAAI,CAAC7C,KAAK,CAACqD,MAAX,EAAmB;AACjBlI,YAAAA,aAAa,CAACqI,MAAd,CAAqB7B,KAArB,CAA2B,GAAGtC,MAAH,CAAU2D,UAAV,EAAsB,YAAtB,EAAoC3D,MAApC,CAA2C4D,WAA3C,EAAwD,sDAAxD,CAA3B;;AAEA;AACD;;AAED,cAAIQ,OAAO,GAAG,GAAGpE,MAAH,CAAU2D,UAAV,EAAsB,YAAtB,EAAoC3D,MAApC,CAA2C4D,WAA3C,EAAwD,IAAxD,EAA8D5D,MAA9D,CAAqEyB,IAAI,CAACnD,MAA1E,EAAkF,GAAlF,CAAd;;AAEAxC,UAAAA,aAAa,CAACqI,MAAd,CAAqBE,KAArB,CAA2B9D,KAA3B,CAAiCzE,aAAa,CAACqI,MAA/C,EAAuD,CAAC1I,OAAO,CAAC6F,QAAR,CAAiB2C,MAAjB,KAA4BtD,KAAK,CAACqD,MAAlC,GAA2CI,OAA3C,GAAqD,GAAGpE,MAAH,CAAUoE,OAAV,EAAmB,mCAAnB,EAAwDpE,MAAxD,CAA+DvE,OAAO,CAAC6F,QAAR,CAAiB2C,MAAhF,EAAwF,QAAxF,EAAkGjE,MAAlG,CAAyGW,KAAK,CAACqD,MAA/G,EAAuH,UAAvH,CAAtD,EAA0LhE,MAA1L,CAAiMxC,kBAAkB,CAACmD,KAAK,CAACN,IAAP,CAAnN,CAAvD;;AAEA,eAAKb,OAAL,CAAamB,KAAb;AACD;AACF,OA9BD,CA8BE,OAAO2B,KAAP,EAAc;AACdxG,QAAAA,aAAa,CAACwI,MAAd,CAAqBhC,KAArB,CAA2BA,KAA3B;AACD;AACF;AApCA,GAzJ4B,CAAnB,CAAZ;;AAgMA,SAAO/G,gBAAP;AACD,CApNmC,EAApC;;AAsNAH,OAAO,CAACG,gBAAR,GAA2BA,gBAA3B;;AAEA,IAAI2I,iBAAiB,GAAG,SAASA,iBAAT,CAA2BvD,KAA3B,EAAkC;AACxD,MAAIO,MAAM,GAAG1D,kBAAkB,CAAC/B,OAAO,CAACkH,QAAR,CAAiBC,gBAAjB,CAAkC,2BAAlC,CAAD,CAA/B,CADwD,CACyC;AACjG;;;AAGA,MAAI2B,cAAc,GAAGrD,MAAM,CAAC4B,MAAP,CAAc,UAAU0B,OAAV,EAAmB;AACpD,QAAI;AACF,aAAOA,OAAO,CAACzB,aAAR,KAA0BpC,KAAK,CAACqD,MAAvC;AACD,KAFD,CAEE,OAAOS,GAAP,EAAY,CAAC;AACd;;AAED,QAAIC,GAAG,GAAGF,OAAO,CAACG,YAAR,CAAqB,KAArB,CAAV;AACA,QAAIV,MAAJ;;AAEA,QAAI;AACF,UAAIW,IAAI,GAAG,IAAIC,GAAJ,CAAQH,GAAR,EAAajJ,OAAO,CAACkH,QAAR,CAAiBrB,QAA9B,CAAX;;AAEA2C,MAAAA,MAAM,GAAGW,IAAI,CAACX,MAAd;AACD,KAJD,CAIE,OAAOQ,GAAP,EAAY;AACZ,aAAO,KAAP;AACD;;AAED,WAAOR,MAAM,KAAKtD,KAAK,CAACsD,MAAxB;AACD,GAlBoB,CAArB;AAAA,MAmBIa,eAAe,GAAG/H,QAAQ,CAACwH,cAAD,CAnB9B;AAAA,MAoBIQ,KAAK,GAAGD,eAAe,CAAC,CAAD,CApB3B;AAAA,MAqBIE,SAAS,GAAGF,eAAe,CAAC9G,KAAhB,CAAsB,CAAtB,CArBhB;;AAuBA,MAAI+G,KAAK,IAAIC,SAAS,CAAC1G,MAAV,KAAqB,CAAlC,EAAqC;AACnC,QAAIoG,GAAG,GAAGK,KAAK,CAACJ,YAAN,CAAmB,KAAnB,CAAV;;AAEA,QAAIM,KAAK,GAAG,IAAIJ,GAAJ,CAAQH,GAAR,EAAajJ,OAAO,CAACkH,QAAR,CAAiBrB,QAA9B,CAAZ;AAAA,QACI2C,MAAM,GAAGgB,KAAK,CAAChB,MADnB;AAAA,QAEIiB,QAAQ,GAAGD,KAAK,CAACC,QAFrB;;AAIA,WAAOjB,MAAM,GAAGiB,QAAhB;AACD;;AAED,MAAIF,SAAS,CAAC1G,MAAV,GAAmB,CAAvB,EAA0B;AACxB;AACAxC,IAAAA,aAAa,CAACwI,MAAd,CAAqBhC,KAArB,CAA2B,4CAA3B;AACD,GAzCuD,CAyCtD;;;AAGF,SAAO,IAAP;AACD,CA7CD;AA8CA;AACA;AACA;;;AAGA,SAAShH,aAAT,CAAuB6J,KAAvB,EAA8B;AAC5B,MAAIrF,IAAI,GAAGqF,KAAK,CAACrF,IAAjB;AACA,MAAIsF,SAAS,GAAG,IAAI7J,gBAAJ,CAAqB;AACnCuE,IAAAA,IAAI,EAAEA;AAD6B,GAArB,CAAhB;AAGA,SAAO,IAAIlE,SAAS,CAAC,SAAD,CAAb,CAAyB;AAC9BwJ,IAAAA,SAAS,EAAEA;AADmB,GAAzB,CAAP;AAGD","sourcesContent":["\"use strict\";\n\nfunction _typeof(obj) { \"@babel/helpers - typeof\"; if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") { _typeof = function _typeof(obj) { return typeof obj; }; } else { _typeof = function _typeof(obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; }; } return _typeof(obj); }\n\nrequire(\"core-js/modules/es.symbol\");\n\nrequire(\"core-js/modules/es.symbol.description\");\n\nrequire(\"core-js/modules/es.symbol.iterator\");\n\nrequire(\"core-js/modules/es.array.concat\");\n\nrequire(\"core-js/modules/es.array.filter\");\n\nrequire(\"core-js/modules/es.array.for-each\");\n\nrequire(\"core-js/modules/es.array.from\");\n\nrequire(\"core-js/modules/es.array.includes\");\n\nrequire(\"core-js/modules/es.array.is-array\");\n\nrequire(\"core-js/modules/es.array.iterator\");\n\nrequire(\"core-js/modules/es.array.map\");\n\nrequire(\"core-js/modules/es.array.slice\");\n\nrequire(\"core-js/modules/es.date.to-string\");\n\nrequire(\"core-js/modules/es.function.bind\");\n\nrequire(\"core-js/modules/es.function.name\");\n\nrequire(\"core-js/modules/es.number.constructor\");\n\nrequire(\"core-js/modules/es.number.is-integer\");\n\nrequire(\"core-js/modules/es.object.define-property\");\n\nrequire(\"core-js/modules/es.object.to-string\");\n\nrequire(\"core-js/modules/es.object.values\");\n\nrequire(\"core-js/modules/es.promise\");\n\nrequire(\"core-js/modules/es.regexp.exec\");\n\nrequire(\"core-js/modules/es.regexp.to-string\");\n\nrequire(\"core-js/modules/es.string.includes\");\n\nrequire(\"core-js/modules/es.string.iterator\");\n\nrequire(\"core-js/modules/es.string.search\");\n\nrequire(\"core-js/modules/web.dom-collections.for-each\");\n\nrequire(\"core-js/modules/web.dom-collections.iterator\");\n\nrequire(\"core-js/modules/web.url\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = createChannel;\nexports.PostmsgTransport = exports.KEY = void 0;\n\nvar _global = require(\"global\");\n\nvar EVENTS = _interopRequireWildcard(require(\"@storybook/core-events\"));\n\nvar _channels = _interopRequireDefault(require(\"@storybook/channels\"));\n\nvar _clientLogger = require(\"@storybook/client-logger\");\n\nvar _telejson = require(\"telejson\");\n\nvar _qs = _interopRequireDefault(require(\"qs\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n\nfunction _getRequireWildcardCache() { if (typeof WeakMap !== \"function\") return null; var cache = new WeakMap(); _getRequireWildcardCache = function _getRequireWildcardCache() { return cache; }; return cache; }\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } if (obj === null || _typeof(obj) !== \"object\" && typeof obj !== \"function\") { return { \"default\": obj }; } var cache = _getRequireWildcardCache(); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj[\"default\"] = obj; if (cache) { cache.set(obj, newObj); } return newObj; }\n\nfunction _toArray(arr) { return _arrayWithHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableRest(); }\n\nfunction _nonIterableRest() { throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }\n\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\n\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\n\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\n\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } }\n\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); return Constructor; }\n\nvar KEY = 'storybook-channel'; // TODO: we should export a method for opening child windows here and keep track of em.\n// that way we can send postMessage to child windows as well, not just iframe\n// https://stackoverflow.com/questions/6340160/how-to-get-the-references-of-all-already-opened-child-windows\n\nexports.KEY = KEY;\n\nvar PostmsgTransport = /*#__PURE__*/function () {\n  function PostmsgTransport(config) {\n    _classCallCheck(this, PostmsgTransport);\n\n    this.config = config;\n    this.buffer = void 0;\n    this.handler = void 0;\n    this.connected = void 0;\n    this.buffer = [];\n    this.handler = null;\n\n    _global.window.addEventListener('message', this.handleEvent.bind(this), false); // Check whether the config.page parameter has a valid value\n\n\n    if (config.page !== 'manager' && config.page !== 'preview') {\n      throw new Error(\"postmsg-channel: \\\"config.page\\\" cannot be \\\"\".concat(config.page, \"\\\"\"));\n    }\n  }\n\n  _createClass(PostmsgTransport, [{\n    key: \"setHandler\",\n    value: function setHandler(handler) {\n      var _this = this;\n\n      this.handler = function () {\n        for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n          args[_key] = arguments[_key];\n        }\n\n        handler.apply(_this, args);\n\n        if (!_this.connected && _this.getLocalFrame().length) {\n          _this.flush();\n\n          _this.connected = true;\n        }\n      };\n    }\n    /**\n     * Sends `event` to the associated window. If the window does not yet exist\n     * the event will be stored in a buffer and sent when the window exists.\n     * @param event\n     */\n\n  }, {\n    key: \"send\",\n    value: function send(event, options) {\n      var _this2 = this;\n\n      var depth = 25;\n      var allowFunction = true;\n      var target;\n\n      if (options && typeof options.allowFunction === 'boolean') {\n        allowFunction = options.allowFunction;\n      }\n\n      if (options && Number.isInteger(options.depth)) {\n        depth = options.depth;\n      }\n\n      if (options && typeof options.target === 'string') {\n        target = options.target;\n      }\n\n      var frames = this.getFrames(target);\n\n      var query = _qs[\"default\"].parse(_global.location.search, {\n        ignoreQueryPrefix: true\n      });\n\n      var data = (0, _telejson.stringify)({\n        key: KEY,\n        event: event,\n        refId: query.refId\n      }, {\n        maxDepth: depth,\n        allowFunction: allowFunction\n      });\n\n      if (!frames.length) {\n        return new Promise(function (resolve, reject) {\n          _this2.buffer.push({\n            event: event,\n            resolve: resolve,\n            reject: reject\n          });\n        });\n      }\n\n      if (this.buffer.length) {\n        this.flush();\n      }\n\n      frames.forEach(function (f) {\n        try {\n          f.postMessage(data, '*');\n        } catch (e) {\n          console.error('sending over postmessage fail');\n        }\n      });\n      return Promise.resolve(null);\n    }\n  }, {\n    key: \"flush\",\n    value: function flush() {\n      var _this3 = this;\n\n      var buffer = this.buffer;\n      this.buffer = [];\n      buffer.forEach(function (item) {\n        _this3.send(item.event).then(item.resolve)[\"catch\"](item.reject);\n      });\n    }\n  }, {\n    key: \"getFrames\",\n    value: function getFrames(target) {\n      if (this.config.page === 'manager') {\n        var nodes = _toConsumableArray(_global.document.querySelectorAll('iframe[data-is-storybook][data-is-loaded]'));\n\n        var list = nodes.filter(function (e) {\n          try {\n            return !!e.contentWindow && e.dataset.isStorybook !== undefined && e.id === target;\n          } catch (er) {\n            return false;\n          }\n        }).map(function (e) {\n          return e.contentWindow;\n        });\n        return list.length ? list : this.getCurrentFrames();\n      }\n\n      if (_global.window && _global.window.parent && _global.window.parent !== _global.window) {\n        return [_global.window.parent];\n      }\n\n      return [];\n    }\n  }, {\n    key: \"getCurrentFrames\",\n    value: function getCurrentFrames() {\n      if (this.config.page === 'manager') {\n        var list = _toConsumableArray(_global.document.querySelectorAll('[data-is-storybook=\"true\"]'));\n\n        return list.map(function (e) {\n          return e.contentWindow;\n        });\n      }\n\n      if (_global.window && _global.window.parent) {\n        return [_global.window.parent];\n      }\n\n      return [];\n    }\n  }, {\n    key: \"getLocalFrame\",\n    value: function getLocalFrame() {\n      if (this.config.page === 'manager') {\n        var list = _toConsumableArray(_global.document.querySelectorAll('#storybook-preview-iframe'));\n\n        return list.map(function (e) {\n          return e.contentWindow;\n        });\n      }\n\n      if (_global.window && _global.window.parent) {\n        return [_global.window.parent];\n      }\n\n      return [];\n    }\n  }, {\n    key: \"handleEvent\",\n    value: function handleEvent(rawEvent) {\n      try {\n        var data = rawEvent.data;\n\n        var _ref = typeof data === 'string' && (0, _telejson.isJSON)(data) ? (0, _telejson.parse)(data) : data,\n            key = _ref.key,\n            event = _ref.event,\n            refId = _ref.refId;\n\n        if (key === KEY) {\n          var pageString = this.config.page === 'manager' ? \"<span style=\\\"color: #37D5D3; background: black\\\"> manager </span>\" : \"<span style=\\\"color: #1EA7FD; background: black\\\"> preview </span>\";\n          var eventString = Object.values(EVENTS).includes(event.type) ? \"<span style=\\\"color: #FF4785\\\">\".concat(event.type, \"</span>\") : \"<span style=\\\"color: #FFAE00\\\">\".concat(event.type, \"</span>\");\n\n          if (refId) {\n            event.refId = refId;\n          }\n\n          event.source = this.config.page === 'preview' ? rawEvent.origin : getEventSourceUrl(rawEvent);\n\n          if (!event.source) {\n            _clientLogger.pretty.error(\"\".concat(pageString, \" received \").concat(eventString, \" but was unable to determine the source of the event\"));\n\n            return;\n          }\n\n          var message = \"\".concat(pageString, \" received \").concat(eventString, \" (\").concat(data.length, \")\");\n\n          _clientLogger.pretty.debug.apply(_clientLogger.pretty, [_global.location.origin !== event.source ? message : \"\".concat(message, \" <span style=\\\"color: gray\\\">(on \").concat(_global.location.origin, \" from \").concat(event.source, \")</span>\")].concat(_toConsumableArray(event.args)));\n\n          this.handler(event);\n        }\n      } catch (error) {\n        _clientLogger.logger.error(error);\n      }\n    }\n  }]);\n\n  return PostmsgTransport;\n}();\n\nexports.PostmsgTransport = PostmsgTransport;\n\nvar getEventSourceUrl = function getEventSourceUrl(event) {\n  var frames = _toConsumableArray(_global.document.querySelectorAll('iframe[data-is-storybook]')); // try to find the originating iframe by matching it's contentWindow\n  // This might not be cross-origin safe\n\n\n  var _frames$filter = frames.filter(function (element) {\n    try {\n      return element.contentWindow === event.source;\n    } catch (err) {// continue\n    }\n\n    var src = element.getAttribute('src');\n    var origin;\n\n    try {\n      var _URL = new URL(src, _global.document.location);\n\n      origin = _URL.origin;\n    } catch (err) {\n      return false;\n    }\n\n    return origin === event.origin;\n  }),\n      _frames$filter2 = _toArray(_frames$filter),\n      frame = _frames$filter2[0],\n      remainder = _frames$filter2.slice(1);\n\n  if (frame && remainder.length === 0) {\n    var src = frame.getAttribute('src');\n\n    var _URL2 = new URL(src, _global.document.location),\n        origin = _URL2.origin,\n        pathname = _URL2.pathname;\n\n    return origin + pathname;\n  }\n\n  if (remainder.length > 0) {\n    // If we found multiple matches, there's going to be trouble\n    _clientLogger.logger.error('found multiple candidates for event source');\n  } // If we found no frames of matches\n\n\n  return null;\n};\n/**\n * Creates a channel which communicates with an iframe or child window.\n */\n\n\nfunction createChannel(_ref2) {\n  var page = _ref2.page;\n  var transport = new PostmsgTransport({\n    page: page\n  });\n  return new _channels[\"default\"]({\n    transport: transport\n  });\n}"]},"metadata":{},"sourceType":"script"}